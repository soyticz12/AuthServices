services:
  db:
    image: postgres:16
    container_name: hris-postgres
    environment:
      POSTGRES_DB: hris_auth
      POSTGRES_USER: hris
      POSTGRES_PASSWORD: hris123
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    container_name: hris-redis
    ports:
      - "6379:6379"
    # optional: persist data (not required for rate limit keys)
    # volumes:
    #   - redisdata:/data

  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hris-auth
    env_file:
      - .env.docker
    environment:
      DB_HOST: db
      ASPNETCORE_ENVIRONMENT: Development

      # Redis connection
      REDIS_HOST: redis
      REDIS_PORT: "6379"

      # Login throttling settings
      LOGIN_MAX_ATTEMPTS: "3"
      LOGIN_WINDOW_SECONDS: "900"
      LOGIN_LOCK_SECONDS: "86400"

      # âœ… Logging: keep your HTTP logs, hide EF SQL logs
      Logging__LogLevel__Default: Information
      Logging__LogLevel__Microsoft: Warning
      Logging__LogLevel__Microsoft.EntityFrameworkCore: Warning
      Logging__LogLevel__Microsoft.EntityFrameworkCore.Database.Command: Warning

    depends_on:
      - db
      - redis
    ports:
      - "8080:8080"

volumes:
  pgdata: # redisdata:
